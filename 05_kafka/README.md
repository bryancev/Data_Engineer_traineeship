
# üîÅ –ü–∞–π–ø–ª–∞–π–Ω: PostgreSQL ‚Üí Kafka ‚Üí ClickHouse

## üìå –û–ø–∏—Å–∞–Ω–∏–µ
–ü–∞–π–ø–ª–∞–π–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω—É—é –∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–µ—Ä–µ–¥–∞—á—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã user_logins –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –≤ ClickHouse –∏–∑ —á–µ—Ä–µ–∑ Apache Kafka. 
–ú–µ—Ö–∞–Ω–∏–∑–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π —Å –ø–æ–º–æ—â—å—é –ø–æ–ª—è `sent_to_kafka = TRUE` –≤ PostgreSQL –∏ `group_id` –≤ Kafka Consumer.

---

## ‚öôÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
PostgreSQL ‚Üí Kafka Producer ‚Üí Kafka Broker ‚Üí Kafka Consumer ‚Üí ClickHouse
```

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üîπ PostgreSQL (`producer.py`)
- –°–æ–∑–¥–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `user_logins`
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–≥–¥–µ `sent_to_kafka = FALSE`) –≤ Kafka
- –ü–æ–º–µ—á–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ (`sent_to_kafka = TRUE`)

### üîπ Kafka
- –¢–æ–ø–∏–∫: `user_events`
- –ë—Ä–æ–∫–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `localhost:9092`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### üîπ ClickHouse (`consumer.py`)
- –ü–æ–¥–ø–∏—Å—á–∏–∫ Kafka (`group_id=user_events_group`)
- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Kafka –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `user_logins`
- –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å–∫ Kafka –∏ Zookeeper
```bash
docker-compose up -d
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
pip install kafka-python psycopg2-binary clickhouse-connect
```

### 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ PostgreSQL
–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
```sql
CREATE TABLE user_logins (
    id SERIAL PRIMARY KEY,
    username TEXT,
    event_type TEXT,
    event_time TIMESTAMP,
    sent_to_kafka BOOLEAN DEFAULT FALSE
);
```

### 4. –ó–∞–ø—É—Å–∫ consumer
```bash
python consumer.py
```

### 5. –ó–∞–ø—É—Å–∫ producer
```bash
python producer.py
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ producer –∏ consumer:
1. –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Kafka
2. Consumer —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ ClickHouse
3. –ü–æ–≤—Ç–æ—Ä–Ω–æ producer –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏

---

## üß™ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ producer.py
‚îú‚îÄ‚îÄ consumer.py
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

---