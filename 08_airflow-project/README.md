
# üõ†Ô∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DAG-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ Airflow

## üìå –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç ETL-–ø–∞–π–ø–ª–∞–π–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Apache Airflow. –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö, –≥–µ–Ω–µ—Ä–∏—Ä—É—è –æ—Ç—á–µ—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—è—è –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
airflow-products-etl/
‚îú‚îÄ‚îÄ dags/                  # DAG-—Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ scripts/               # SQL –∏ Python-—Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ data/                  # CSV/JSON –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ templates/             # Jinja2-—à–∞–±–ª–æ–Ω—ã
‚îú‚îÄ‚îÄ reports/               # –ò—Ç–æ–≥–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã
‚îú‚îÄ‚îÄ generate_dags.py       # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä DAG'–æ–≤
‚îî‚îÄ‚îÄ docker-compose.yml     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏ Python 3.8+
2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <url>
cd airflow-products-etl
mkdir -p scripts/sql scripts/python data templates dags reports
```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Airflow:
```bash
docker-compose up -d
python generate_dags.py
```
4. –û—Ç–∫—Ä–æ–π—Ç–µ [http://localhost:8080](http://localhost:8080), –ª–æ–≥–∏–Ω: `airflow`, –ø–∞—Ä–æ–ª—å: `airflow`

## üîÑ –û–ø–∏—Å–∞–Ω–∏–µ DAG'–æ–≤

| DAG                          | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|------------------------------|-----------------------------------|
| `sql_products_create_tables` | –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)    |
| `csv_products_load`          | –ó–∞–≥—Ä—É–∑–∫–∞ CSV –≤ –ë–î (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)     |
| `sql_products_transform`     | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ) |
| `py_products_analysis`       | –ê–Ω–∞–ª–∏–∑ –∏ –æ—Ç—á–µ—Ç (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)        |
| `py_products_quality`        | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)     |

## üóÉÔ∏è –ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü

```sql
products (
    id INT PRIMARY KEY,
    name TEXT,
    price DECIMAL,
    category TEXT
)

products_transformed (
    id INT,
    name TEXT,
    price DECIMAL,
    category TEXT,
    price_category TEXT,
    created_at TIMESTAMP
)
```

## üìà –ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–æ–≤
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `reports/`.

**–û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∞–º**
```
–í—Å–µ–≥–æ: 10
–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: 8450.00 —Ä—É–±.
–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:
- –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞: 2
- –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã: 4
- –ê—É–¥–∏–æ: 1
- –ù–∞–∫–æ–ø–∏—Ç–µ–ª–∏: 2
- Unknown: 1
```

**–û—Ç—á–µ—Ç –ø–æ –∫–∞—á–µ—Å—Ç–≤—É**
```
–ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π: 2
- ID 2: —Ü–µ–Ω–∞ -1200
- ID 8: —Ü–µ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Airflow

–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `postgres_default`:
- –¢–∏–ø: PostgreSQL
- –•–æ—Å—Ç: `pg_extra`, –ø–æ—Ä—Ç: `5432`
- –ë–î: `postgres`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `extradb_user`
- –ü–∞—Ä–æ–ª—å: `extradb_password`

## ‚öôÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DAG'–æ–≤ (`generate_dags.py`)

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç DAG-—Ñ–∞–π–ª—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- SQL-—Ñ–∞–π–ª–æ–≤ (`scripts/sql/*.sql`)
- Python-—Å–∫—Ä–∏–ø—Ç–æ–≤ (`scripts/python/*.py`)
- CSV-—Ñ–∞–π–ª–æ–≤ —Å JSON-—Å—Ö–µ–º–æ–π (`data/*.csv` + `data/*.json`)

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:
```bash
python generate_dags.py
```
–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ DAG'–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ø–∞–ø–∫–µ `dags/`.

---

